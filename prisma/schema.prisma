// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Client {
  clientId     String   @id @default(uuid()) @db.Uuid
  clientName   String   @unique
  hashedSecret String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  Ticket       Ticket[]

  @@map("application")
}

model Ticket {
  ticketId       String         @unique
  jiraIssueId    String         @unique
  summary        String
  description    String
  issueType      IssueType
  ticketStatus   TicketStatus
  priority       Priority
  issueCreatedBy String         @db.Uuid
  client         Client         @relation(fields: [clientId], references: [clientId])
  clientId       String         @db.Uuid
  category       TicketCategory @relation(fields: [categoryId], references: [categoryId])
  categoryId     Int
  project        Project        @relation(fields: [projectKey], references: [projectKey])
  projectKey     String
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  @@map("tickets")
}

model TicketCategory {
  categoryId   Int      @id @default(autoincrement())
  categoryName String   @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  tickets Ticket[]

  @@map("ticket_categories")
}

model Project {
  projectId   Int      @id @default(autoincrement())
  projectName String   @unique
  projectKey  String   @unique
  tickets     Ticket[]
  maxTicketValue Int
  ticketValue Int
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("application_config")
}

enum IssueType {
  TASK
  BUG
  STORY
}

enum TicketStatus {
  TO_DO 
  IN_PROGRESS
  RESOLVED
}

enum Priority {
  LOW
  MEDIUM
  HIGH
}
